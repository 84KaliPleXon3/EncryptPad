<h1>Open a plain text file, protect it with a key file and save as a GPG file</h1>
<h2>Open a plain text file</h2>
<p>1. Click the Open File tool button</p>
<p><img alt="Open File tool button" src="images/open_text_file.png" /></p>
<p>2. Select Plain Text file type and click Save button</p>
<p><img alt="Plain Text file type" src="images/open_file_dialog_text_file.png" /></p>
<p>3. The plain text file opened</p>
<p><img alt="Text file opened" src="images/text_file_opened.png" /></p>
<p>Now EncryptPad is in unprotected plain text mode. It works as an ordinary text editor.</p>
<p><img alt="Unprotected mode" src="images/unprotected_status.png" /></p>
<h2>Generate a new key file</h2>
<p>4. Click the Generate Key tool button.</p>
<p><img alt="Generate Key tool button" src="images/generate_key_tool_button.png" /></p>
<p>5. Select the Key In Repository radio button and enter <code>my_new_key</code> in the corresponding text box and click OK.</p>
<p><img alt="Generate Key dialogue" src="images/generate_key_dialog.png" /></p>
<p>6. You will be asked to enter a password to protect the key file on the disk.</p>
<p><img alt="Key File Password" src="images/set_password_for_key.png" /></p>
<p>Enter <code>KeyPwd</code></p>
<p>7. Click Yes to use the new key file to encrypt our text.</p>
<p><img alt="Use new key dialogue" src="images/use_new_key_dialog.png" /></p>
<p>8. You can look at the key file in your user profile directory under <code>_encryptpad</code></p>
<p><img alt="Key in Windows Explorer" src="images/key_in_explorer.png" /></p>
<p>Here is the content of the file (it will be different for you as the key is random):<br/> </p>
<pre><code>-----BEGIN PGP MESSAGE-----

ww0ECQMIwHjM/7M8CP1g0lwBTWLhkWz6OgNJ++rjgwES+WIWttapxGFG76nANeuC
FtCIN9xGbsFFm1g9iJRxMgWlUz9s97+tC7PVhxgCDTsfbfbFA54UAdRClR0hqoPA
S27p6/6u5ztvfGWGrw==
=bXn9
-----END PGP MESSAGE-----
</code></pre>
<p>This is a random sequence in Base64, from which the encryption key is derived. It is encrypted with the key file password that you provided and it can also be unencrypted with GnuGPG. If you have <a href="https://www.gpg4win.org/">Gpg4Win</a> installed, you can right click on the file in explorer and open "More GPG EX options" and "Decrypt". Enter <code>KeyPwd</code> as a password and gpg will decrypt the file and create my_new_key.key.out. The content of the file will be similar to this:</p>
<pre><code>T6/vlnb0aysdr+xUriwwwrC844iVImiG4T/sCgF+ETQ=
</code></pre>
<h2>Protect with the key file and save as a GPG file</h2>
<p>9. Click the Save As tool button.</p>
<p><img alt="Save As tool button" src="images/save_as_tool_button.png" /></p>
<p>10. Select GnuPG file type and click Save button</p>
<p><img alt="Save As dialogue" src="images/save_as_dialog.png" /></p>
<p>Please note that the file name has changed to <code>war and peace.gpg</code> in the Save As dialogue.</p>
<p>11. Now the file has been saved on the disk and it is encrypted with the generated key file. See the status in the picture below.</p>
<p><img alt="GPG file saved" src="images/key_protected_status.png" /></p>
<h2>The GPG file on disk</h2>
<p>It is an Open PGP file. You can send it to someone who does not have EncryptPad. It is easily decrypted with <a href="https://www.gpg4win.org/">Gpg4Win</a>. Use the content of the key file as a passphrase <code>T6/vlnb0aysdr+xUriwwwrC844iVImiG4T/sCgF+ETQ=</code> (see step 8).</p>
<p><img alt="Kleopatra decrypted our file" src="images/kleopatra_decrypted.png" /></p>
<p>GPG packet --list-packets command output:</p>
<pre><code>gpg --list-packets "war and peace.gpg"

:symkey enc packet: version 4, cipher 9, s2k 3, hash 8
        salt 1c73cc8df90a54d5, count 65536 (96)
gpg: AES256 encrypted data
:encrypted data packet:
        length: 1201175
        mdc_method: 2
gpg: encrypted with 1 passphrase
:compressed packet: algo=2
:literal data packet:
        mode t (74), created 0, name="CONSOLE",
        raw data: unknown length
</code></pre>
<h2>View or change the key file used for protection</h2>
<p>12. Click Set Key tool button.</p>
<p><img alt="Set Key tool button" src="images/set_key_tool_button.png" /></p>
<p>13. View the selected key file in Set Key dialogue</p>
<p><img alt="Set Key dialogue" src="images/set_key_dialog.png" /></p>
<p>File without path is looked for in the EncryptPad directory first and then in the repository in HOME (see the text in the picture above). If your key is not in the repository, you can specify a full path to your key. </p>
<p><code>Persist key location in encrypted file</code> is not supported for GPG files (see README.md). Leave it blank for now. TODO:add the link to the EPD double encryption manual.</p>
<h2>Open another plain text file</h2>
<p>If you try to open a plain text file now, it will fail with the following message.</p>
<p><img alt="Cannot open plain text" src="images/open_another_plain_text.png" /></p>
<p>EncryptPad "thinks" that the file is encrypted with a key file because its mode is "Key protected" as you can see in the status bar. It tried to decrypt the plain text and failed. To proceed with opening the file, clear key protection by clicking the Clear Key tool button or even better click Close and Reset. The latter will close the text file and reset both parts of the protection.</p>
<p><img alt="Clear Key or Close and Reset" src="images/clear_key_or_close_and_reset.png" /></p>
<p>Now you can open your plain text file.</p>